{{ define "main" }}
<main class="vt-wrap">

  {{/* --- Collect slotted recipes --- */}}
  {{ $all := where .Site.RegularPages "Section" "recipes" }}
  {{ $slotted := where $all ".Params.slot" "ne" nil }}

  {{/* --- Vault capacity panel --- */}}
  {{ $loaded := len $slotted }}
  {{ $capacity := 33 }}

  {{/* Safe integer percentage for inline width (avoid calc with template math) */}}
  {{ $pct := div (mul $loaded 100) $capacity }}

  <header class="vt-registry-header">
    <div class="vt-placard">
      <div class="vt-placard__top">
        <h1 class="vt-title">Vault Registry</h1>
        <p class="vt-subtitle">
          Vault 33 Registry • <span id="vt-loaded">{{ $loaded }}</span> / {{ $capacity }} slots loaded
        </p>
      </div>

      <div class="vt-capacity" role="status" aria-live="polite">
        <div class="vt-capacity__label">
          <span class="vt-capacity__text">Capacity</span>
          <span class="vt-capacity__count">
            <span id="vt-loaded-2">{{ $loaded }}</span> / {{ $capacity }}
          </span>
        </div>

        {{/* Bar is optional; CSS can hide it on mobile. Keeping it valid. */}}
        <div class="vt-capacity__bar" aria-hidden="true">
          <div class="vt-capacity__fill" style="width: {{ $pct }}%;"></div>
        </div>
      </div>

      <nav class="vt-filters" aria-label="Registry filters">
        <button class="vt-filter is-active" type="button" data-filter="all" aria-pressed="true">
          All <span class="sr-only">recipes</span>
        </button>
        <button class="vt-filter" type="button" data-filter="core" aria-pressed="false">Core Rations</button>
        <button class="vt-filter" type="button" data-filter="specialty" aria-pressed="false">Specialty Modules</button>
        <button class="vt-filter" type="button" data-filter="legacy" aria-pressed="false">Legacy Recipes</button>
        <button class="vt-filter" type="button" data-filter="desserts" aria-pressed="false">Desserts &amp; Treats</button>
        <button class="vt-filter" type="button" data-filter="wildcards" aria-pressed="false">Wildcards</button>

        <div class="vt-filters__spacer" aria-hidden="true"></div>

        <button class="vt-filter vt-filter--primary" type="button" id="vt-random">
          Dispense Random Ration
        </button>
      </nav>
    </div>
  </header>

  {{/* --- Category sections (canonical by slot range) --- */}}

  <section class="vt-section" data-category="core" id="core" aria-labelledby="sec-core">
    <div class="vt-section__head">
      <h2 class="vt-section__title" id="sec-core">Core Rations</h2>
      <div class="vt-section__range">VT-01 → VT-10</div>
    </div>

    <div class="vt-grid">
      {{ range $slot := seq 1 10 }}
        {{ $p := index (where $slotted ".Params.slot" $slot) 0 }}
        {{ partial "registry-slot-card.html" (dict "Slot" $slot "Page" $p) }}
      {{ end }}
    </div>
  </section>

  <section class="vt-section" data-category="specialty" id="specialty" aria-labelledby="sec-specialty">
    <div class="vt-section__head">
      <h2 class="vt-section__title" id="sec-specialty">Specialty Modules</h2>
      <div class="vt-section__range">VT-11 → VT-18</div>
    </div>

    <div class="vt-grid">
      {{ range $slot := seq 11 18 }}
        {{ $p := index (where $slotted ".Params.slot" $slot) 0 }}
        {{ partial "registry-slot-card.html" (dict "Slot" $slot "Page" $p) }}
      {{ end }}
    </div>
  </section>

  <section class="vt-section" data-category="legacy" id="legacy" aria-labelledby="sec-legacy">
    <div class="vt-section__head">
      <h2 class="vt-section__title" id="sec-legacy">Legacy Recipes</h2>
      <div class="vt-section__range">VT-19 → VT-25</div>
    </div>

    <div class="vt-grid">
      {{ range $slot := seq 19 25 }}
        {{ $p := index (where $slotted ".Params.slot" $slot) 0 }}
        {{ partial "registry-slot-card.html" (dict "Slot" $slot "Page" $p) }}
      {{ end }}
    </div>
  </section>

  <section class="vt-section" data-category="desserts" id="desserts" aria-labelledby="sec-desserts">
    <div class="vt-section__head">
      <h2 class="vt-section__title" id="sec-desserts">Desserts &amp; Treats</h2>
      <div class="vt-section__range">VT-26 → VT-30</div>
    </div>

    <div class="vt-grid">
      {{ range $slot := seq 26 30 }}
        {{ $p := index (where $slotted ".Params.slot" $slot) 0 }}
        {{ partial "registry-slot-card.html" (dict "Slot" $slot "Page" $p) }}
      {{ end }}
    </div>
  </section>

  <section class="vt-section" data-category="wildcards" id="wildcards" aria-labelledby="sec-wildcards">
    <div class="vt-section__head">
      <h2 class="vt-section__title" id="sec-wildcards">Wildcards</h2>
      <div class="vt-section__range">VT-31 → VT-33</div>
    </div>

    <div class="vt-grid">
      {{ range $slot := seq 31 33 }}
        {{ $p := index (where $slotted ".Params.slot" $slot) 0 }}
        {{ partial "registry-slot-card.html" (dict "Slot" $slot "Page" $p) }}
      {{ end }}
    </div>
  </section>

</main>

{{/* Registry behavior */}}
<script defer src="/js/registry.js"></script>
{{ end }}
