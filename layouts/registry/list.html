{{ define "main" }}
  {{ $max := 33 }}
  {{ $recipes := where .Site.RegularPages "Section" "recipes" }}

  {{ $slotMap := dict }}
  {{ range $recipes }}
    {{ if and (isset .Params "slot") (ne .Title "") }}
      {{ $key := printf "%d" .Params.slot }}
      {{ $slotMap = merge $slotMap (dict $key .) }}
    {{ end }}
  {{ end }}


  {{/* Count loaded slots */}}
  {{ $loaded := 0 }}
  {{ range $i := seq 1 $max }}
    {{ $k := printf "%d" $i }}
    {{ if index $slotMap $k }}
      {{ $loaded = add $loaded 1 }}
    {{ end }}
  {{ end }}

  <h1>Vault Registry</h1>

  <div class="card">
    <div class="meta" style="font-weight:800;">
      Vault 33 Registry • {{ $loaded }} / {{ $max }} slots loaded
    </div>
    <div class="meta" style="margin-top:6px;">
      Slots are explicit. Assign <code>slot: 1</code> through <code>slot: 33</code> in recipe front matter.
    </div>
  </div>

  <div class="card" style="margin-top:14px;">
    <div class="grid" style="gap:10px;">
      {{ range $i := seq 1 $max }}
        {{ $k := printf "%d" $i }}
        {{ $slot := printf "%02d" $i }}
        {{ $p := index $slotMap $k }}

        <div style="display:flex; align-items:baseline; justify-content:space-between; gap:12px; flex-wrap:wrap;">
          <div style="display:flex; gap:10px; align-items:baseline; flex-wrap:wrap;">
            <span class="chip" style="min-width:70px; justify-content:center;">VT-{{ $slot }}</span>

            {{ if $p }}
              <a href="{{ $p.RelPermalink }}" style="font-size:16px; font-weight:900;">{{ $p.Title }}</a>
            {{ else }}
              <span style="font-size:14px; font-weight:900; opacity:0.6;">[ EMPTY SLOT ]</span>
            {{ end }}
          </div>

          <div class="meta">
            {{ if $p }}
              {{ with $p.Params.servings }}{{ . }} servings{{ end }}
              {{ with $p.Params.totalTime }} • Total: {{ . }}{{ end }}
            {{ else }}
              <span style="opacity:0.6;">Available</span>
            {{ end }}
          </div>
        </div>

        {{ if $p }}
          {{ with $p.Params.tags }}
            <div class="chips" style="margin:-2px 0 10px 80px;">
              {{ range . }}
                <a class="chip" href="/tags/{{ . | urlize }}/">{{ . }}</a>
              {{ end }}
            </div>
          {{ end }}
        {{ else }}
          <div class="meta" style="margin:-2px 0 10px 80px; opacity:0.6;">
            Assign this slot by adding <code>slot: {{ $i }}</code> to a recipe.
          </div>
        {{ end }}

        {{ if lt $i $max }}<hr />{{ end }}
      {{ end }}
    </div>
  </div>
{{ end }}
