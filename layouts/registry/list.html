{{ define "main" }}
<main class="vt-wrap">

  {{/* --- Collect slotted recipes --- */}}
  {{ $all := where .Site.RegularPages "Section" "recipes" }}
  {{ $slotted := where $all ".Params.slot" "ne" nil }}

  {{/* --- Vault capacity panel --- */}}
  {{ $loaded := len $slotted }}
  {{ $capacity := 33 }}

  <header class="vt-registry-header">
    <div class="vt-placard">
      <div class="vt-placard__top">
        <h1 class="vt-title">Vault Registry</h1>
        <p class="vt-subtitle">Vault 33 Registry • <span id="vt-loaded">{{ $loaded }}</span> / {{ $capacity }} slots loaded</p>
      </div>

      <div class="vt-capacity" role="status" aria-live="polite">
        <div class="vt-capacity__label">
          <span class="vt-capacity__text">Capacity</span>
          <span class="vt-capacity__count"><span id="vt-loaded-2">{{ $loaded }}</span> / {{ $capacity }}</span>
        </div>
        <div class="vt-capacity__bar" aria-hidden="true">
          <div class="vt-capacity__fill" style="width: calc(({{ $loaded }} / {{ $capacity }}) * 100%);"></div>
        </div>
      </div>

      <nav class="vt-filters" aria-label="Registry filters">
        <button class="vt-filter is-active" type="button" data-filter="all">
          All <span class="sr-only">recipes</span>
        </button>
        <button class="vt-filter" type="button" data-filter="core">Core Rations</button>
        <button class="vt-filter" type="button" data-filter="specialty">Specialty Modules</button>
        <button class="vt-filter" type="button" data-filter="legacy">Legacy Recipes</button>
        <button class="vt-filter" type="button" data-filter="desserts">Desserts &amp; Treats</button>
        <button class="vt-filter" type="button" data-filter="wildcards">Wildcards</button>

        <div class="vt-filters__spacer" aria-hidden="true"></div>

        <button class="vt-filter vt-filter--primary" type="button" id="vt-random">
          Dispense Random Ration
        </button>
      </nav>
    </div>
  </header>

  {{/* --- Helper: render a category section by slot range --- */}}
  {{/* Note: we keep slot ranges canonical per your plan */}}

  <section class="vt-section" data-category="core" id="core">
    <h2 class="vt-section__title">Core Rations <span class="vt-section__range">(VT-01 → VT-10)</span></h2>
    <div class="vt-grid">
      {{ range $slot := seq 1 10 }}
        {{ $p := index (where $slotted ".Params.slot" $slot) 0 }}
        {{ partial "registry-slot-card.html" (dict "Slot" $slot "Page" $p) }}
      {{ end }}
    </div>
  </section>

  <section class="vt-section" data-category="specialty" id="specialty">
    <h2 class="vt-section__title">Specialty Modules <span class="vt-section__range">(VT-11 → VT-18)</span></h2>
    <div class="vt-grid">
      {{ range $slot := seq 11 18 }}
        {{ $p := index (where $slotted ".Params.slot" $slot) 0 }}
        {{ partial "registry-slot-card.html" (dict "Slot" $slot "Page" $p) }}
      {{ end }}
    </div>
  </section>

  <section class="vt-section" data-category="legacy" id="legacy">
    <h2 class="vt-section__title">Legacy Recipes <span class="vt-section__range">(VT-19 → VT-25)</span></h2>
    <div class="vt-grid">
      {{ range $slot := seq 19 25 }}
        {{ $p := index (where $slotted ".Params.slot" $slot) 0 }}
        {{ partial "registry-slot-card.html" (dict "Slot" $slot "Page" $p) }}
      {{ end }}
    </div>
  </section>

  <section class="vt-section" data-category="desserts" id="desserts">
    <h2 class="vt-section__title">Desserts &amp; Treats <span class="vt-section__range">(VT-26 → VT-30)</span></h2>
    <div class="vt-grid">
      {{ range $slot := seq 26 30 }}
        {{ $p := index (where $slotted ".Params.slot" $slot) 0 }}
        {{ partial "registry-slot-card.html" (dict "Slot" $slot "Page" $p) }}
      {{ end }}
    </div>
  </section>

  <section class="vt-section" data-category="wildcards" id="wildcards">
    <h2 class="vt-section__title">Wildcards <span class="vt-section__range">(VT-31 → VT-33)</span></h2>
    <div class="vt-grid">
      {{ range $slot := seq 31 33 }}
        {{ $p := index (where $slotted ".Params.slot" $slot) 0 }}
        {{ partial "registry-slot-card.html" (dict "Slot" $slot "Page" $p) }}
      {{ end }}
    </div>
  </section>

</main>

{{/* Registry behavior */}}
<script defer src="/js/registry.js"></script>
{{ end }}
