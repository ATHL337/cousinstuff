{{- /* layouts/partials/rads-score.html */ -}}

{{- $slug := "" -}}

{{- /* Called from a recipe page: .Params.slug */ -}}
{{- with .Params.slug -}}
  {{- $slug = . -}}
{{- end -}}

{{- /* Called from leaderboard: (dict "slug" $slug) */ -}}
{{- if eq $slug "" -}}
  {{- with .slug -}}
    {{- $slug = . -}}
  {{- end -}}
{{- end -}}

{{- /* Fallback: file base name if this is a Page */ -}}
{{- if eq $slug "" -}}
  {{- with .File -}}
    {{- $slug = .ContentBaseName -}}
  {{- end -}}
{{- end -}}

{{- /* Load votes */ -}}
{{- $votes := site.Data.rads_votes -}}
{{- $v := dict -}}
{{- if and $slug (index $votes $slug) -}}
  {{- $v = index $votes $slug -}}
{{- end -}}

{{- /* Family-first weights (tweak later if you want) */ -}}
{{- $weights := dict
  "you"    0.20
  "spouse" 0.25
  "k1"     0.15
  "k2"     0.15
  "k3"     0.15
  "k4"     0.10
-}}

{{- /* Votes default safely to 0 if missing */ -}}
{{- $you    := float (default 0 (index $v "you")) -}}
{{- $spouse := float (default 0 (index $v "spouse")) -}}
{{- $k1     := float (default 0 (index $v "k1")) -}}
{{- $k2     := float (default 0 (index $v "k2")) -}}
{{- $k3     := float (default 0 (index $v "k3")) -}}
{{- $k4     := float (default 0 (index $v "k4")) -}}

{{- $score :=
  add
    (mul $you    (index $weights "you"))
    (mul $spouse (index $weights "spouse"))
    (mul $k1     (index $weights "k1"))
    (mul $k2     (index $weights "k2"))
    (mul $k3     (index $weights "k3"))
    (mul $k4     (index $weights "k4"))
-}}

{{- $isRated := gt (len $v) 0 -}}

{{- /* Tiering (simple for now; you can tighten thresholds later) */ -}}
{{- $tier := "Unscored" -}}
{{- if $isRated -}}
  {{- if ge $score 10.0 -}}
    {{- $tier = "Core Candidate" -}}
  {{- else if ge $score 5.0 -}}
    {{- $tier = "Specialty" -}}
  {{- else -}}
    {{- $tier = "Wildcard" -}}
  {{- end -}}
{{- end -}}

{{- return (dict "slug" $slug "score" $score "tier" $tier "isRated" $isRated) -}}
