{{/* layouts/partials/rads-score.html
     Usage: {{ partial "rads-score.html" (dict "slug" $slug "site" $.Site) }}
     Returns: dict {score tier votes}
*/}}

{{- $slug := .slug -}}
{{- $site := .site -}}
{{- $votes := (index $site.Data "rads_votes") | default dict -}}
{{- $v := (index $votes $slug) | default dict -}}

{{- /* Family-first weighting (Option B: realistic, kid-heavy) */ -}}
{{- $wYou := 0.12 -}}
{{- $wSpouse := 0.18 -}}
{{- $wK1 := 0.17 -}}
{{- $wK2 := 0.20 -}}
{{- $wK3 := 0.20 -}}
{{- $wK4 := 0.13 -}}

{{- $you := (index $v "you") | default 0 -}}
{{- $sp  := (index $v "spouse") | default 0 -}}
{{- $k1  := (index $v "k1") | default 0 -}}
{{- $k2  := (index $v "k2") | default 0 -}}
{{- $k3  := (index $v "k3") | default 0 -}}
{{- $k4  := (index $v "k4") | default 0 -}}

{{- $score := add
    (mul $you $wYou)
    (mul $sp  $wSpouse)
    (mul $k1  $wK1)
    (mul $k2  $wK2)
    (mul $k3  $wK3)
    (mul $k4  $wK4)
-}}
{{- $score = printf "%.0f" $score | int -}}

{{- /* Tier gates (Family-first):
      12+ = Core lock, 9-11 = Core candidate, 6-8 = Specialty, 3-5 = Wildcard, else Unscored
*/ -}}
{{- $tier := "unscored" -}}
{{- if ge $score 12 -}}
  {{- $tier = "core-lock" -}}
{{- else if ge $score 9 -}}
  {{- $tier = "core-candidate" -}}
{{- else if ge $score 6 -}}
  {{- $tier = "specialty" -}}
{{- else if ge $score 3 -}}
  {{- $tier = "wildcard" -}}
{{- end -}}

{{- return (dict
  "score" $score
  "tier" $tier
  "votes" (dict "you" $you "spouse" $sp "k1" $k1 "k2" $k2 "k3" $k3 "k4" $k4)
) -}}
