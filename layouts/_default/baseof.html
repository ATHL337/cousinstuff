<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />

    {{- $siteTitle := .Site.Title -}}
    {{- $pageTitle := cond .IsHome $siteTitle (printf "%s | %s" .Title $siteTitle) -}}
    <title>{{ $pageTitle }}</title>

    {{- $desc := (or .Params.description .Description .Site.Params.description) -}}
    <meta name="description" content="{{ $desc }}" />

    <!-- Canonical -->
    <link rel="canonical" href="{{ .Permalink }}" />

    <!-- Robots (override per-page with front matter: robots: "noindex,nofollow") -->
    <meta name="robots" content="{{ with .Params.robots }}{{ . }}{{ else }}index,follow{{ end }}" />

    {{- /* ------------------------------------------------------------
          IMAGE SELECTION (single source of truth)
          - Recipe hero image should come from: .Params.image
          - Social OG/Twitter should come from: .Params.images[0]
          - Fallbacks: og_image -> site ogImage
          This prevents the OG image from accidentally being used as hero.
        ------------------------------------------------------------ */ -}}
    {{- $og := "" -}}
    {{- with .Params.images -}}
      {{- if gt (len .) 0 -}}
        {{- $og = (index . 0) -}}
      {{- end -}}
    {{- end -}}
    {{- if and (not $og) .Params.og_image -}}
      {{- $og = .Params.og_image -}}
    {{- end -}}
    {{- if and (not $og) .Site.Params.ogImage -}}
      {{- $og = .Site.Params.ogImage -}}
    {{- end -}}

    {{- $hero := "" -}}
    {{- with .Params.image -}}
      {{- $hero = . -}}
    {{- end -}}

    <!-- Open Graph -->
    <meta property="og:site_name" content="{{ $siteTitle }}" />
    <meta property="og:type" content="{{ if .IsHome }}website{{ else }}article{{ end }}" />
    <meta property="og:url" content="{{ .Permalink }}" />
    <meta property="og:title" content="{{ $pageTitle }}" />
    <meta property="og:description" content="{{ $desc }}" />
    {{- if $og -}}
      <meta property="og:image" content="{{ $og | absURL }}" />
    {{- end -}}

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="{{ $pageTitle }}" />
    <meta name="twitter:description" content="{{ $desc }}" />
    {{- with .Site.Params.twitter -}}
      <meta name="twitter:site" content="@{{ . }}" />
    {{- end -}}
    {{- if $og -}}
      <meta name="twitter:image" content="{{ $og | absURL }}" />
    {{- end -}}

    <!-- Styles -->
    <link rel="stylesheet" href="/css/site.css" />
    <link rel="stylesheet" href="/css/vault-tec-corp.css" />

    <!-- Scripts -->
    <script src="/js/theme.js" defer></script>
    <script src="/js/nav-compact.js" defer></script>
    <script src="/js/skin.js" defer></script>

    <!-- Schema: only on recipe single pages -->
    {{- if and .IsPage (eq .Section "recipes") -}}
      {{ partial "recipe_schema.html" . }}
    {{- end -}}
  </head>

  <body class="vt-has-bottombar">
    <div class="container">

      <!-- Top header -->
      <div class="nav no-print" id="siteNav">
        <div class="brand">
          <a class="title" href="/">{{ .Site.Params.brand }}</a>
          <span class="tagline">{{ .Site.Params.description }}</span>
        </div>

        <div class="actions">
          <a class="btn secondary" href="/registry/">Registry</a>
          <a class="btn secondary" href="/recipes/">Recipes</a>
          <a class="btn secondary" href="/tags/">Tags</a>
		  <a class="btn secondary" href="/vault/rads-leaderboard/">☢️ RADS</a>


          <!-- Desktop utilities (hidden on mobile by CSS) -->
          <button id="themeToggleTop" class="btn secondary vt-util vt-util--theme" type="button" aria-label="Toggle dark mode">
            Dark mode
          </button>
          <button id="skinToggleTop" class="btn secondary vt-util vt-util--skin" type="button" aria-label="Toggle skin">
            Pip-Boy
          </button>
        </div>
      </div>

      <!-- Mobile bottom utility bar -->
      <div class="vt-bottombar no-print" role="navigation" aria-label="Vault utilities">
        <div class="vt-bottombar__inner">
          {{ partial "vault_capacity.html" . }}

          {{ if eq .RelPermalink "/registry/" }}
            <button class="btn accent vt-bottombar__random" type="button" id="vt-random-bottom">
              Random Ration
            </button>
          {{ end }}

          <button id="themeToggleBottom" class="btn secondary vt-bottombar__toggle" type="button" aria-label="Toggle dark mode">
            Dark mode
          </button>

          <button id="skinToggleBottom" class="btn secondary vt-bottombar__toggle" type="button" aria-label="Toggle skin">
            Pip-Boy
          </button>
        </div>
      </div>

      <main>
        {{ block "main" . }}{{ end }}
      </main>

      <footer class="vt-legal">
        <br />
        <div class="vt-legal-inner">
          <span class="vt-legal-brand">© {{ now.Year }} {{ .Site.Params.brand }}</span>
          <span class="vt-legal-dot">•</span>
          <span>Built with love</span>
          <span class="vt-legal-dot">•</span>
          <span class="vt-legal-subtle">Unofficial fan project</span>
        </div>
        <div class="vt-legal-subline">
          Fallout-inspired aesthetic • Not affiliated with or endorsed by Bethesda Softworks
        </div>
      </footer>

    </div>
  </body>
</html>
